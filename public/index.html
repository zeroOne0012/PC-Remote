<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volume Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        button {
            font-size: 18px;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }
        #volume-display {
            font-size: 20px;
            margin-top: 20px;
        }
        input{
            width:300px;
        }
        h1{
            margin-top: 100px;
        }
    </style>
        <!-- <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script> -->
</head>
<body>
    <h1>ğŸ”Š ë³¼ë¥¨ ì¡°ì ˆ</h1>
    <button onclick="changeVolume('/volume/down/1')">ğŸ”» 1% ê°ì†Œ</button>
    <button onclick="changeVolume('/volume/up/1')">ğŸ”º 1% ì¦ê°€</button>
    <button onclick="changeVolume('/volume/down/10')">ğŸ”» 10% ê°ì†Œ</button>
    <button onclick="changeVolume('/volume/up/10')">ğŸ”º 10% ì¦ê°€</button>
    <p id="volume-display">í˜„ì¬ ë³¼ë¥¨: <span id="volume">ë¡œë“œ ì¤‘...</span></p>

    <h1>ğŸ”š ìë™ ì¢…ë£Œ ì„¤ì •</h1>
    <input type="number" id="shutdown-time" placeholder="ì¢…ë£Œê¹Œì§€ ì‹œê°„(ì´ˆ) ì…ë ¥(1ì‹œê°„:3600)" min="1" value="3600">
    <button onclick="shutdown()">ì¢…ë£Œ ì˜ˆì•½</button>
    <button onclick="cancel()">ì¢…ë£Œ ì·¨ì†Œ</button>
    <p id="remaining-time"></p> <!-- ë‚¨ì€ ì‹œê°„ í‘œì‹œ -->

    <h1>ğŸ“¹ ìœ íŠœë¸Œ</h1>
    <input id="youtube-search" placeholder="ìœ íŠœë¸Œ ê²€ìƒ‰ì–´ ì…ë ¥" value="4ì›”ì€ ë„ˆì˜ ê±°ì§“ë§ bgm">
    <button onclick="search()">ê²€ìƒ‰</button>


    <script>

        function changeVolume(apiUrl) {
            fetch(apiUrl)
                .then(response => response.text())
                .then(() => updateVolume());
        }

        function updateVolume() {
            fetch('/volume')
                .then(response => response.text())
                .then(volume => {
                    document.getElementById('volume').innerText = volume;
                });
        }


        async function cancel(){
            await fetch('/cancel');
            alert('ì¢…ë£Œ ì·¨ì†Œ');
        }


        // shutdown ë²„íŠ¼ event
        async function shutdown(){
            let sec = document.getElementById("shutdown-time").value;
            if (sec && !isNaN(sec) && sec > 0) {
                const result = await fetch(`/shutdown/${sec}`).then(a=>a.text());
                alert(result);
                // startTimer(sec);
            } else {
                alert("ìˆ«ì ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! (ì–‘ìˆ˜)");
            }
        }




        // ì„œë²„ì™€ ì—°ê²°
        // const socket = new WebSocket('ws://localhost:3000'); // ëª¨ë°”ì¼ ì ìš© ì•ˆë¨
        const socket = new WebSocket(`ws://${window.location.hostname}:3000/`);

        // ì„œë²„ë¡œë¶€í„° ë©”ì‹œì§€ ìˆ˜ì‹ 
        socket.onmessage = function(event) {
            document.getElementById('remaining-time').innerText = event.data;
        };



        // ìœ íŠœë¸Œ ê²€ìƒ‰
        async function search(){
            let s = document.getElementById('youtube-search').value;
            fetch(`/youtube/search?term=${s}`)
            .then(res=>{
                if(!res.ok){throw new Error('network error');}
                // return res.json();
                // alert("ê²€ìƒ‰ ì™„ë£Œ");
            })
            .then(data=>console.log(data))
            .catch(err=>console.error(err));
        }


        // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰/íƒ€ì´ë¨¸ ì‹¤í–‰
        document.getElementById('youtube-search').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                search(); // ì—”í„° í‚¤ë¥¼ ëˆ„ë¥´ë©´ search() í•¨ìˆ˜ ì‹¤í–‰
            }
        });
        document.getElementById('shutdown-time').addEventListener('keypress', function(event){
            if(event.key==='Enter'){
                shutdown();
            }
        })



        window.onload = updateVolume; // í˜ì´ì§€ ë¡œë“œ ì‹œ ë³¼ë¥¨ ì—…ë°ì´íŠ¸
    </script>
</body>
</html>
